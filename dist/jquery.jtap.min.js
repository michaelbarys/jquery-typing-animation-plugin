/*! jtap - v0.0.1 - 2016-04-14
* Copyright (c) 2016 Michał Baryś; Licensed MIT */
!function(a){"use strict";var b=function(b,c){this.el=a(b),this.options=a.extend({},a.fn.jtap.defaults,c),console.log(this.options),this.content=null,this.isInput=!1,this.isTag=!1,this.index=0,this.timer=null,this.isPaused=!1,this.backspaceIndexes=[],this.init()};b.prototype={init:function(){"INPUT"===this.el.prop("tagName")&&(this.isInput=!0),this.isInput?(this.content=this.el.val(),this.el.val(""),this.el.focus()):(this.setElementSize(),this.content=this.el.html(),this.el.empty()),this.el.addClass("jtap").addClass("jtap-idle"),this.options.cursor===!0&&this.el.addClass("jtap-cursor"),this.options.skipTags===!0&&(this.content=this.content.replace(/(<([^>]+)>)/gi,"")),this.content=this.content.replace(/\r?\n|\r|\t/g,"");var a=this;setTimeout(function(){a.start()},this.options.startDelay)},setElementSize:function(){this.el.width(this.el.width()),this.el.height(this.el.height())},clearTimer:function(){clearTimeout(this.timer),this.timer=null},prepare:function(){for(var a,b=/({([^}]+)})/gi,c=0;null!==(a=b.exec(this.content));){var d=a.index-c++,e=b.lastIndex-1-++c;this.backspaceIndexes.push([d,e]),console.log("start: "+d,"end: "+e)}this.content=this.content.replace(/({|})/gi,"")},humanize:function(a){return this.options.humanize===!1?a:(a*=Math.round(2*Math.random())+1===1?Math.round(5*Math.random())+1:Math.round(5*Math.random())+1,console.log(a),a)},start:function(){this.isPaused=!1,this.el.removeClass("jtap-idle"),this.options.onStart&&this.options.onStart(),this.prepare(),this.type()},type:function(){if(this.isPaused===!0)return void console.log("is paused");var a=this.content.slice(0,++this.index),b=this,c=!1;if(this.backspaceIndexes.forEach(function(a,d){a[1]===b.index-2&&(b.clearTimer(),b["delete"](),c=!0)}),!c){this.options.onTypeBefore&&this.options.onTypeBefore(this.index-1,a.slice(-1),a),this.isInput?this.el.val(a):this.el.empty().html(a),this.options.onTypeAfter&&this.options.onTypeAfter(this.index-1,a.slice(-1),a);var d=a.slice(-1);return"<"===d&&(this.isTag=!0),">"===d&&(this.isTag=!1),this.isTag?this.type():a===this.content?void this.complete():void(this.timer=setTimeout(function(){b.type()},this.humanize(this.options.speed)))}},"delete":function(){var a=this.content.slice(0,--this.index),b=this,c=!1;this.backspaceIndexes.forEach(function(a,d){if(a[0]===b.index+1){b.clearTimer();var e=b.backspaceIndexes.shift();b.content=b.content.slice(0,e[0])+b.content.slice(e[1]+1),b.backspaceIndexes.length>0&&(b.backspaceIndexes[d][0]-=e[1]-e[0]+1,b.backspaceIndexes[d][1]-=e[1]-e[0]+1),b.type(),c=!0}}),c||(this.isInput?this.el.val(a):this.el.empty().html(a),clearTimeout(this.timer),this.timer=null,this.timer=setTimeout(function(){b["delete"]()},this.humanize(this.options.backspaceSpeed)))},complete:function(){this.el.removeAttr("style"),this.options.onComplete&&(this.el.addClass("jtap-idle"),this.options.onComplete())},pause:function(a){if(console.log("pause",this.timer),this.isPaused=!0,clearTimeout(this.timer),this.el.addClass("jtap-idle"),"undefined"!=typeof a){var b=this;setTimeout(function(){b.resume()},a)}},resume:function(){this.isPaused=!1,this.el.removeClass("jtap-idle"),this.type()},reset:function(a){this.timer=null,this.index=0,a||(a=this.options.startDelay),this.pause();var b=this;setTimeout(function(){b.start()},a)}},a.fn.jtap=function(c,d){return this.each(function(){var e=a(this),f=e.data("typed"),g="object"==typeof c&&c;f||e.data("typed",f=new b(this,g)),"string"==typeof c&&("undefined"!=typeof d&&f.options.hasOwnProperty(c)?f.options[c]=d:f[c](d))})},a.fn.jtap.defaults={cursor:!0,startDelay:0,speed:50,backspaceSpeed:200,humanize:!0,skipTags:!0,onStart:null,onTypeBefore:null,onTypeAfter:null,onComplete:null}}(jQuery);